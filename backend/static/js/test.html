<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Module Tests</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body>
    <div class="container mt-5">
        <h1>JavaScript Module Tests</h1>

        <div class="card mt-4">
            <div class="card-header">
                <h3>VaitikanApp Tests</h3>
            </div>
            <div class="card-body">
                <button class="btn btn-primary" onclick="testToast()">Test Toast</button>
                <button class="btn btn-warning" onclick="testConfirm()">Test Confirm</button>
                <button class="btn btn-danger" onclick="testDeleteConfirm()">Test Delete Confirm</button>
                <button class="btn btn-info" onclick="testLoading()">Test Loading</button>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h3>Form Validation Tests</h3>
            </div>
            <div class="card-body">
                <form data-validate id="testForm">
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="quantity" class="form-label">Quantity (1-100)</label>
                        <input type="number" class="form-control" id="quantity" min="1" max="100" required>
                    </div>
                    <div class="mb-3">
                        <label for="phone" class="form-label">Phone</label>
                        <input type="tel" class="form-control" id="phone" data-validate-phone required>
                    </div>
                    <button type="submit" class="btn btn-success">Submit</button>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h3>Cart Module Tests</h3>
            </div>
            <div class="card-body">
                <button class="btn btn-primary" onclick="testValidateQuantity()">Test Validate Quantity</button>
                <button class="btn btn-info" onclick="testFormatPrice()">Test Format Price</button>
                <button class="btn btn-warning" onclick="testCalculateTotals()">Test Calculate Totals</button>
                <div id="cartTestResults" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
    <script src="cart.js"></script>
    <script src="form-validation.js"></script>

    <script>
        // VaitikanApp Tests
        function testToast() {
            VaitikanApp.showToast('This is a success toast!', 'success');
            setTimeout(() => VaitikanApp.showToast('This is an error toast!', 'error'), 1000);
            setTimeout(() => VaitikanApp.showToast('This is a warning toast!', 'warning'), 2000);
            setTimeout(() => VaitikanApp.showToast('This is an info toast!', 'info'), 3000);
        }

        function testConfirm() {
            VaitikanApp.showConfirm('Do you want to proceed?', function () {
                VaitikanApp.showToast('Confirmed!', 'success');
            });
        }

        function testDeleteConfirm() {
            VaitikanApp.showDeleteConfirm('Are you sure you want to delete?', function () {
                VaitikanApp.showToast('Deleted!', 'success');
            });
        }

        function testLoading() {
            VaitikanApp.showLoading('Processing...');
            setTimeout(() => {
                VaitikanApp.hideLoading();
                VaitikanApp.showToast('Loading complete!', 'success');
            }, 2000);
        }

        // Cart Module Tests
        function testValidateQuantity() {
            const results = document.getElementById('cartTestResults');
            const tests = [
                { qty: 5, max: 10, expected: true },
                { qty: 15, max: 10, expected: false },
                { qty: 0, max: 10, expected: false },
                { qty: -5, max: 10, expected: false },
                { qty: 'abc', max: 10, expected: false }
            ];

            let html = '<h5>Quantity Validation Tests:</h5><ul>';
            tests.forEach(test => {
                const result = CartModule.validateQuantity(test.qty, test.max);
                const passed = result.isValid === test.expected;
                html += `<li class="${passed ? 'text-success' : 'text-danger'}">
                    Qty: ${test.qty}, Max: ${test.max} - ${passed ? '✓ PASS' : '✗ FAIL'} 
                    (${result.message})
                </li>`;
            });
            html += '</ul>';
            results.innerHTML = html;
        }

        function testFormatPrice() {
            const results = document.getElementById('cartTestResults');
            const tests = [1234.56, 999.99, 0, 12345678.90];

            let html = '<h5>Price Formatting Tests:</h5><ul>';
            tests.forEach(price => {
                const formatted = CartModule.formatPrice(price);
                html += `<li>${price} → ${formatted}</li>`;
            });
            html += '</ul>';
            results.innerHTML = html;
        }

        function testCalculateTotals() {
            const results = document.getElementById('cartTestResults');
            const mockCart = {
                items: [
                    {
                        variant_size: {
                            variant: { base_price: '100.00' }
                        },
                        quantity: 2
                    },
                    {
                        variant_size: {
                            variant: { base_price: '150.00' }
                        },
                        quantity: 1
                    }
                ]
            };

            const totals = CartModule.calculateCartTotals(mockCart);

            let html = '<h5>Cart Totals Calculation:</h5><ul>';
            html += `<li>Subtotal: ${CartModule.formatPrice(totals.subtotal)}</li>`;
            html += `<li>Tax (${totals.taxRate * 100}%): ${CartModule.formatPrice(totals.tax)}</li>`;
            html += `<li>Total: ${CartModule.formatPrice(totals.total)}</li>`;
            html += `<li>Item Count: ${totals.itemCount}</li>`;
            html += '</ul>';
            results.innerHTML = html;
        }

        // Form validation test
        document.getElementById('testForm').addEventListener('submit', function (e) {
            e.preventDefault();
            VaitikanApp.showToast('Form is valid!', 'success');
        });

        console.log('All modules loaded successfully!');
        console.log('VaitikanApp:', typeof VaitikanApp);
        console.log('CartModule:', typeof CartModule);
        console.log('FormValidation:', typeof FormValidation);
    </script>
</body>

</html>